# XDG Base Directory仕様への設定ファイル移行

## 概要

現在のkrappの設定ファイル管理をXDG Base Directory仕様に準拠するように変更する。

## 現在の設定ファイル管理

### 現在の構造
- **グローバル設定**: `~/.krapp_config.yaml`
- **ローカル設定**: `./.krapp_config.yaml`
- **設定読み込み順序**: デフォルト設定 → グローバル設定 → ローカル設定

### 設定ファイルの管理場所
- `config/config.go`の`defaultConfigPaths`構造体で定義
- `ConfigPaths`構造体でグローバル/ローカルのパスを管理
- 設定パスの変更は`SetConfigPaths()`関数で可能

## 変更後の設定ファイル管理

### 変更後の構造
- **グローバル設定**: `~/.config/krapp/config.yaml`
- **ローカル設定**: `./.krapp_config.yaml` (変更なし)
- **設定読み込み順序**: デフォルト設定 → グローバル設定 → ローカル設定 (変更なし)

### XDG Base Directory仕様の詳細
- `$XDG_CONFIG_HOME`環境変数が設定されている場合: `$XDG_CONFIG_HOME/krapp/config.yaml`
- `$XDG_CONFIG_HOME`が未設定の場合: `~/.config/krapp/config.yaml`

## 影響範囲分析

### 修正が必要なファイル

#### 1. `config/config.go`
- **場所**: lines 43-46
- **修正内容**: `defaultConfigPaths`の`Global`フィールドを変更
- **影響**: 
  - `GetDefaultConfigPaths()`関数の戻り値が変更
  - 新しい設定ファイルパスでの作成・読み込みが必要

#### 2. `config/config_test.go`
- **場所**: lines 21-24
- **修正内容**: テストで使用される設定ファイルパスを更新
- **影響**: 
  - `setupConfigFile()`関数内のパス指定
  - テストクリーンアップ処理でのファイル削除パス

#### 3. ドキュメントファイル
- **CLAUDE.md**: グローバル設定ファイルパスの記述を更新
- **README.md**: 設定ファイルの説明を更新

### 実装上の考慮事項

#### 1. 既存設定の移行
- 既存の`~/.krapp_config_global.yaml`から新しいパスへの移行処理が必要
- 移行処理は初回実行時に自動で行う
- 移行後、古いファイルは削除または警告表示

#### 2. ディレクトリ作成
- `~/.config/krapp/`ディレクトリの作成処理が必要
- 親ディレクトリ（`~/.config/`）が存在しない場合の処理

#### 3. エラーハンドリング
- 設定ディレクトリ作成権限エラーの処理
- 既存ファイルの移行失敗時の処理

#### 4. 後方互換性
- 段階的移行: 既存パスが存在する場合は警告表示
- 将来的な完全移行のためのタイムライン設定

## 実装手順

### Phase 1: 基本実装
1. XDG仕様に対応した設定パス生成関数の実装
2. `defaultConfigPaths`の更新
3. ディレクトリ作成処理の追加

### Phase 2: 移行処理
1. 既存設定ファイルの検出・移行処理
2. 移行完了後の古いファイル削除
3. 移行ログ・警告メッセージの実装

### Phase 3: テスト・ドキュメント更新
1. テストケースの更新
2. ドキュメントファイルの更新
3. エラーケースのテスト追加

## 変更によるメリット

1. **標準準拠**: Linux/Unix系OSの標準的な設定ファイル配置
2. **整理整頓**: 設定ファイルが`~/.config/`以下に統一
3. **バックアップ**: 設定ディレクトリ単位でのバックアップが容易
4. **マルチユーザー対応**: XDG仕様によるより良いマルチユーザー環境サポート

## 破壊的変更

- 既存ユーザーは設定ファイルの場所が変更される
- 移行処理により影響を最小化するが、手動設定が必要な場合がある
- 古いパスを参照しているスクリプトなどは更新が必要

## テスト戦略

1. **既存設定の移行テスト**
2. **新規設定ファイル作成テスト**
3. **XDG環境変数の有無によるテスト**
4. **権限エラー時の処理テスト**
5. **後方互換性のテスト**
